<!doctype html>
<html lang="en">
<head>
    <title>Tic Tac Toe Game</title>
    <meta charset="UTF-8">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />

    <!-- bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Chewy' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>

    <style>
      body {
        background-color: #0E1442;
        font-family: 'Open Sans', sans-serif;
      }

      h1 {
        font-family: 'Chewy', cursive;
        font-size: 48px;
        padding-left: 20px;
      }

      table {
        width:300px;
      }
      td {
        width:100px;
        height:100px;
        text-align: center;
        font-size:40px;
        color: white;
      }
      .bottom {
        border-bottom: solid white 1px;
      }
      .top {
        border-top: solid white 1px;
      }
      .right {
        border-right: solid white 1px;
      }
      .left {
        border-left: solid white 1px;
      }
      .centered {
        display:block;
        margin-left:auto;
        margin-right:auto;
      }
      .btn {
        text-align: center;
        color:black;
      }
      .win {
        color: orange;
      }
      #footer {
        margin-top: 40px;
      }
      .nav {
        margin:20px;
      }
      .navbar-toggle {
        margin: 30px;
      }
      .navbar-toggle: hover {
        background-color:#0E1442;
      }
      .icon-bar {
        color:black;
      }
      .btn {
        display:inline;
      }
      #footer {
        margin-left:auto;
        margin-right:auto;
        list-style: none;
        text-align: center;
      }
      #footer li {
        display: inline;
      }
      #status {
        color: orange;
        font-size: 18px;
      }
      form {
        color: white;
      }
      input {
        width: 40px;
        color: black;
      }

      @media screen and (max-width:700px) {
        h1 {
          text-align: center;
        }
      }
    </style>
</head>
<body>
  <div class="row">
      <nav class="navbar navbar-default">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <h1><strong>Tic Tac Toe</strong></h1>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://ncabelin.github.io" class="text-center">Home</a></li>
            <li><a href="http://ncabelin.github.io/udresume" class="text-center">About</a></li>
            <li><a href="mailto:ncabelin@gmail.com" class="text-center">Contact</a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
  </div>
  <div class="container-fluid">
  <table class="centered">
    <tr>
      <td value = 1 class="bottom right" id="one"></td>
      <td value = 2 class="bottom" id="two"></td>
      <td value = 3 class="bottom left" id="three"></td>
    </tr>
    <tr>
      <td value = 4 class="bottom right" id="four"></td>
      <td value = 5 class="bottom" id="five"></td>
      <td value = 6 class="bottom left" id="six"></td>
    </tr>
    <tr>
      <td value = 7 class="right" id="seven"></td>
      <td value = 8 id="eight"></td>
      <td value = 9 class="left" id="nine"></td>
    </tr>
    </div>
  </table>
    <ul id="footer">
      <li><button class="btn btn-danger centered" id="reset">Reset Game</button>
      <li><button class="btn btn-success centered" id="xPlay">Play as X</button>
      <li><button class="btn btn-primary centered" id="oPlay">Play as O</button>
    </ul>
    <div class="row">
      <div class="col-md-12 btn-group center-block text-center" role="group">
        <form>
          <label for="human">Human</label>
          <input readonly id="human" value=0>
          <label for="comp">Computer</label>
          <input readonly id="comp" value=0>
        </form>
        <p id="status"></p>
      </div>
    </div>
  
   <!-- jquery -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- bootstrap js -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script>

$(document).ready(function() {
  var ids = {
    1 : $("#one"),
    2 : $("#two"),
    3 : $("#three"),
    4 : $("#four"),
    5 : $("#five"),
    6 : $("#six"),
    7 : $("#seven"),
    8 : $("#eight"),
    9 : $("#nine"),
    }

  var resetB = $("#reset");
  var xPlayB = $("#xPlay");
  var oPlayB = $("#oPlay");
  var status = $("#status");
  var humanScore = $("#human");
  var compScore = $("#comp");
  var hScore = 0;
  var cScore = 0;
  var won = false;
  var move = 0;
  var occArr = [];
  var cMove;

  var winning = [ [1,2,3], [4,5,6], [7,8,9], [1,4,7], [2,5,8], [3,6,9], [1,5,9], [3,5,7] ];

  function reset() {
    move = 0;
    human.moves = [];
    computer.moves = [];
    occArr = [];
    cMove = 0;
    // empty out each cell
    for (var i = 1; i < 10; i++) {
      ids[i].empty();
    }
    won = false;
  };

  function Player(symbol, state) {
    this.symbol = symbol;
    this.state = state;
    this.moves = [];
  }

  var human = new Player("X", "human");

  var computer = new Player("O", "computer");

  xPlayB.click(function() {
    human.symbol = "X";
    computer.symbol = "O";
  });

  oPlayB.click(function() {
    human.symbol = "O";
    computer.symbol = "X";
  });

  resetB.click(function() {
    reset();
  });

  Player.prototype.moveTo = function(position) {
    var pos = Number(position);
    this.moves.push(pos); // push to own moves array
    ids[position].html(this.symbol); // print symbol in corresponding cell
    occArr.push(pos); // mark cell occupied
    console.log(pos + " is the " + this.state + " move");
  }

  Player.prototype.checkMove = function() {
    won = false;
    var symb = this.symbol;
    var self = this;
    for (var i = 0; i < winning.length; i++) { // cycle through each winning array
      var rightMove = 0;
      var winningArr = [];
      var winningIndex = [];

      this.moves.forEach(function(move) {
        var check = winning[i].indexOf(move);
        if (check !== -1) {
          rightMove++;
          winningArr.push(move);
          winningIndex.push(check);

          // if 3 numbers match winning array combo
          if (rightMove == 3) { 
            for (var j = 0; j < winningArr.length; j++) {
              ids[winningArr[j]].html("<span class='win'>" + symb + "</span>");
            }
            status.html("Player " + symb + " WINS ! ");
            if (self.state == "human") {
              hScore++;
              humanScore.attr("value", hScore);
            } else {
              cScore++;
              compScore.attr("value", cScore);
            }
            won = true;
            return;
          }
        }
      });
      if (occArr.length == 9 && won == false) {
        status.html("DRAW ! No one won"); 
      }
    }
  }

  function findEmptyCells() {
    var emptyArr = [];
    for (var a = 1; a < 10; a++) { // generate empty cells Array
      var b = occArr.indexOf(a);
      if (b == -1) {
        emptyArr.push(a);
      }
    }
    return emptyArr;
  }

  function randomMove() {
    var emptied = findEmptyCells();
    var rand = emptied[Math.floor(Math.random() * emptied.length)]; 
    return rand;   
  }

  Player.prototype.smartMove = function() { // computer generated move, if occArr = 1, random if human didn't do center cell, 3 and above do smart AI
    var foundAnswer = false;
    var check1 = occArr.indexOf(5);
    if (check1 == -1 && occArr.length == 1) {
      return cMove = 5;
    }
    cMove = randomMove();
    if (occArr.length > 1) {
      winning.forEach(function(winData) {
        var rightMove = 0;
        var winningArr = [];
        var winningIndex = [];

        // look at own moves
        computer.moves.forEach(function(move) {
          var check = winData.indexOf(move);
          if (check !== -1) {
            rightMove++;
            winningArr.push(move);
            winningIndex.push(check);

            if (rightMove == 2) {
             // find out the other number and check if it exists in occArr already.

              var missingMove;
              var a = winningIndex.indexOf(0);
              var b = winningIndex.indexOf(1);
              var c = winningIndex.indexOf(2);
              if (a == -1) {
                missingMove = winData[0];
              } else if (b == -1) {
                missingMove = winData[1];
              } else if (c == -1) {
                missingMove = winData[2];
              }

               // if move exists, return. if not then it is the cMove (correct move)
              var check2 = occArr.indexOf(missingMove);
              if (check2 == -1) {
                console.log(winningArr + " is the winning array with 2 cells and so " + missingMove + " is the right answer");
                foundAnswer = true;
                cMove = missingMove;
                return;
              }
            }
          }
        });
      });

      if (foundAnswer) { return };

      // iterate through each winning array combination
      winning.forEach(function(winData) {
        rightMove = 0;
        winningArr = [];
        winningIndex = [];

        // compare current human moves array to current winning array combo 
        human.moves.forEach(function(move) {
          var check = winData.indexOf(move);
          if (check !== -1) {
            rightMove++;
            winningArr.push(move);
            winningIndex.push(check);

            // if 2 numbers match winning array combo
            if (rightMove == 2) {
              // find out the other number and check if it exists in occArr already.
              var missingMove;
              var a = winningIndex.indexOf(0);
              var b = winningIndex.indexOf(1);
              var c = winningIndex.indexOf(2);
              if (a == -1) {
                missingMove = winData[0];
              } else if (b == -1) {
                missingMove = winData[1];
              } else if (c == -1) {
                missingMove = winData[2];
              }

              // if move exists, return. if not then it is the cMove (correct move)
              var check2 = occArr.indexOf(missingMove);
              if (check2 == -1) {
                console.log(winningArr + " is the winning array with 2 cells and so " + missingMove + " is the right counter");
                cMove = missingMove;
                return;
              }
            }
          }
        });
      });  
    }
  }

  $("td").click(function() {

    status.empty();
    if (won == true || occArr.length === 9) { // reset if a player won already
      reset();
    } else {
      var moved = Number($(this).attr("value")); // x is position of move
      var y = ids[moved]; // y is the jQuery DOM location of td cell clicked

      // prevents player from move if cell is occupied already

      var zed = occArr.indexOf(moved);
      if (zed !== -1) {
        status.html("That cell is taken, choose another one");
        return;
      }

      human.moveTo(moved);
      human.checkMove();

      if (won == false && occArr.length < 9) {
        computer.smartMove(); // generate cMove (AI move)
        setTimeout(function() { 
          computer.moveTo(cMove);
          computer.checkMove(); 
        }, 500); // provide delay to simulate human thinking delay of half a second

      }
    }
  }); 


});
    
</script>
</body>
</html>
